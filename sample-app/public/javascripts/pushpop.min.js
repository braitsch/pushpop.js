function PushPop(e){function i(e){return o(e)?("fixed size"==s.mode?s.width=$(this).val():"fixed ratio"==s.mode&&(s.ratio.width=$(this).val()),!0):!1}function t(e){return o(e)?("fixed size"==s.mode?s.height=$(this).val():"fixed ratio"==s.mode&&(s.ratio.height=$(this).val()),!0):!1}function o(e){if(4==$(e.target).val().toString().length)return!1;var i=window.event?e.keyCode:e.which;return 8===i||46===i||37===i||39===i?!0:!(48>i||i>57)}var a={upload:"/upload","delete":"/delete"},d=void 0;e&&(e.api&&(a.upload=e.api.upload,a["delete"]=e.api["delete"]),e.maxFileSize&&(d=e.maxFileSize));var s={mode:"normal",width:100,height:100,ratio:{width:16,height:9}};this.openPopModal=function(e){r.data("index",$(e).data("index")),r.data("pname",$(e).data("pname"));var i=$(".modal-pop .media-preview img"),t=$(".modal-pop .media-preview iframe");"image"==$(e).data("media").type?(i.show(),i.attr("src",$(e).data("url"))):"video"==$(e).data("media").type&&(t.show(),t.attr("src",$(e).data("url"))),r.modal("show")},this.openPushModal=function(){n.modal("show")};var r=$(".modal-pop"),n=$(".modal-push"),h=$(".modal-push #image form"),l=$(".modal-push #video form"),u=$(".modal-push .media-preview img"),m=$(".modal-push .media-preview iframe"),p=$(".modal-push .file-dialog"),c=$(".modal-push .progress"),f=$(".modal-push .thumb-settings"),g=$(".modal-push .media-dropdown"),v=$(".modal-push #image .media-input"),w=$(".modal-push #video .media-input"),b=$(".modal-push .btn-select"),x=($(".modal-push .btn-upload"),$(".modal-push .btn-save-video"),$(".modal-push .instructions")),y={width:0,height:0},k={url:"",preview:""};g.change(function(e){j(),"image"==this.value.toLowerCase()?($("#image").show(),$("#video").hide(),u.show(),m.hide(),c.show(),f.show(),void 0!=u.attr("src")&&x.show()):"video"==this.value.toLowerCase()&&($("#image").hide(),$("#video").show(),u.hide(),m.show(),c.hide(),f.hide(),x.hide())}),b.click(function(e){p.click()}),p.change(function(e){if(j(),this.files&&this.files[0])if(d&&this.files[0].size/1e3/1e3>d)alert("The maximum file size for uploads in this demo is "+d+"MB.");else{var i=new FileReader;i.onload=function(e){var i=new Image;i.onload=function(){y.width=i.width,y.height=i.height},i.src=e.target.result,u.attr("src",e.target.result),v.val(p.val().replace(/C:\\fakepath\\/i,""))},i.readAsDataURL(this.files[0]),x.show()}}),h.ajaxForm({url:a.upload,beforeSubmit:function(e,i,t){if(S.width()>0||S.height()>0){var o=y.width/L.width(),a=y.height/L.height();s.crop.x=(S.offset().left-L.offset().left)*o,s.crop.y=(S.offset().top-L.offset().top)*a,s.crop.w=S.width()*o,s.crop.h=S.height()*a,"fixed size"!=s.mode&&(s.width=0,s.height=0),e.push({name:"thumb",value:JSON.stringify(s)})}e.push({name:"type",value:"image"}),console.log("------ sending data ------");for(var d=0;d<e.length;d++){if("file-dialog"==e[d].name&&!e[d].value)return alert("please select an image"),!1;console.log(d,e[d].name,e[d].value)}return!0},uploadProgress:function(e,i,t,o){$(".progress-bar").width(.8*o+"%")},success:function(){$(".progress-bar").width("100%"),console.log("success")},complete:function(e){$(".progress-bar").width("100%"),setTimeout(C,500)}}),w.bind("paste",function(e){setTimeout(function(){k.url=w.val(),-1!=k.url.search("youtube")?(k.id=k.url.substring(k.url.lastIndexOf("?v=")+3),k.url="https://www.youtube.com/embed/"+k.id,m.attr("src",k.url),k.preview="https://img.youtube.com/vi/"+k.id+"/hqdefault.jpg"):-1!=k.url.search("vimeo")&&(k.id=k.url.substring(k.url.lastIndexOf("/")+1),k.url="https://player.vimeo.com/video/"+k.id,m.attr("src",k.url),$.get("https://vimeo.com/api/v2/video/"+k.id+".json",function(e){k.preview=e[0].thumbnail_large}))},1)}),l.ajaxForm({url:a.upload,beforeSubmit:function(e,i,t){return console.log("sending"),e.push({name:"type",value:"video"}),e.push({name:"url",value:k.url}),e.push({name:"preview",value:k.preview}),!0},complete:function(e){setTimeout(C,500)}});var C=function(){n.modal("hide"),n.on("hidden.bs.modal",function(e){location.reload(!0)})},z=function(){r.modal("hide"),r.on("hidden.bs.modal",function(e){location.reload(!0)})};$(".thumb-settings .w").keyup(i),$(".thumb-settings .h").keyup(t),$(".thumb-settings .s1").change(function(e){s.mode=this.value.toLowerCase(),"normal"==s.mode?($(".thumb-settings .w").val(""),$(".thumb-settings .h").val("")):"fixed ratio"==s.mode?($(".thumb-settings .w").val(s.ratio.width),$(".thumb-settings .h").val(s.ratio.height)):"fixed size"==s.mode&&($(".thumb-settings .w").val(s.width),$(".thumb-settings .h").val(s.height)),$(".thumb-settings .w").prop("disabled","normal"==s.mode),$(".thumb-settings .h").prop("disabled","normal"==s.mode)}),$(".thumb-settings .s2").change(function(e){$(".thumb-generator").css("border-color",this.value.toLowerCase())});var L=$(".media-preview img"),S=$(".thumb-generator"),F=$(".media-preview");S.hide(),L.on("dragstart",function(e){e.preventDefault()});var T=parseInt($(".modal-body").css("padding"))+parseInt($(".modal-push .well").css("padding")),j=function(){S.hide(),s.crop={}},I=function(e){var i={x:e.clientX+T,y:e.clientY+T},t={x:F.offset().left-$(window).scrollLeft(),y:F.offset().top-$(window).scrollTop()};return{x:i.x-t.x,y:i.y-t.y}},P=function(e){var i=I(e),t=i.x-s.crop.x,o=i.y-s.crop.y;"fixed ratio"==s.mode&&(o=t*(s.ratio.height/s.ratio.width)),S.css({width:t,height:o})},M=function(e){var i=I(e);s.crop={},s.crop.x=i.x,s.crop.y=i.y,S.css({left:s.crop.x,top:s.crop.y}),"fixed size"!=s.mode?(L.bind("mousemove",P),L.css("cursor","crosshair"),S.css({width:0,height:0})):S.css({width:s.width*(L.width()/y.width),height:s.height*(L.height()/y.height)}),S.show()},O=function(){L.css("cursor","default"),L.unbind("mousemove",P)};$(window).bind("mouseup",O),L.bind("mousedown",M),document.addEventListener("keydown",function(e){S.is(":visible")&&(37==e.keyCode?s.crop.x--:38==e.keyCode?s.crop.y--:39==e.keyCode?s.crop.x++:40==e.keyCode&&s.crop.y++,S.css({left:s.crop.x,top:s.crop.y}))},!1),$(".modal-pop").on("hidden.bs.modal",function(e){var i=$(".modal-pop .media-preview img"),t=$(".modal-pop .media-preview iframe");i.hide(),i.attr("src",""),t.hide(),t.attr("src","")}),$(".modal-pop form").ajaxForm({url:a["delete"],beforeSubmit:function(e,i,t){e.push({name:"pname",value:r.data("pname")}),e.push({name:"index",value:r.data("index")})},complete:function(e){setTimeout(z,500)}})}