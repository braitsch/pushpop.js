function PushPop(){function e(e){return i(e)?("fixed size"==a.mode?a.width=$(this).val():"fixed ratio"==a.mode&&(a.ratio.width=$(this).val()),!0):!1}function t(e){return i(e)?("fixed size"==a.mode?a.height=$(this).val():"fixed ratio"==a.mode&&(a.ratio.height=$(this).val()),!0):!1}function i(e){if(4==$(e.target).val().toString().length)return!1;var t=window.event?e.keyCode:e.which;return 8===t||46===t||37===t||39===t?!0:!(48>t||t>57)}var o={upload:"/upload","delete":"/delete"},a={mode:"normal",width:100,height:100,ratio:{width:16,height:9}},s=1;this.openPopModal=function(e){d.data("index",$(e).data("index")),d.data("pname",$(e).data("pname"));var t=$(".modal-pop .media-preview img"),i=$(".modal-pop .media-preview iframe");"image"==$(e).data("media").type?(t.show(),t.attr("src",$(e).data("url"))):"video"==$(e).data("media").type&&(i.show(),i.attr("src",$(e).data("url"))),d.modal("show")},this.openPushModal=function(){r.modal("show")};var d=$(".modal-pop"),r=$(".modal-push"),n=$(".modal-push #image form"),h=$(".modal-push #video form"),u=$(".modal-push .media-preview img"),l=$(".modal-push .media-preview iframe"),m=$(".modal-push .file-dialog"),p=$(".modal-push .progress"),c=$(".modal-push .thumb-settings"),f=$(".modal-push .media-dropdown"),g=$(".modal-push #image .media-input"),v=$(".modal-push #video .media-input"),w=$(".modal-push .btn-select"),b=($(".modal-push .btn-upload"),$(".modal-push .btn-save-video"),$(".modal-push .instructions")),x={width:0,height:0},y={url:"",preview:""};f.change(function(e){I(),"image"==this.value.toLowerCase()?($("#image").show(),$("#video").hide(),u.show(),l.hide(),p.show(),c.show(),void 0!=u.attr("src")&&b.show()):"video"==this.value.toLowerCase()&&($("#image").hide(),$("#video").show(),u.hide(),l.show(),p.hide(),c.hide(),b.hide())}),w.click(function(e){m.click()}),m.change(function(e){if(I(),this.files&&this.files[0])if(s&&this.files[0].size/1e3/1e3>s)alert("The maximum file size for uploads in this demo is "+s+"MB.");else{var t=new FileReader;t.onload=function(e){var t=new Image;t.onload=function(){x.width=t.width,x.height=t.height},t.src=e.target.result,u.attr("src",e.target.result),g.val(m.val().replace(/C:\\fakepath\\/i,""))},t.readAsDataURL(this.files[0]),b.show()}}),n.ajaxForm({url:o.upload,beforeSubmit:function(e,t,i){if(L.width()>0||L.height()>0){var o=x.width/z.width(),s=x.height/z.height();a.crop.x=(L.offset().left-z.offset().left)*o,a.crop.y=(L.offset().top-z.offset().top)*s,a.crop.w=L.width()*o,a.crop.h=L.height()*s,"fixed size"!=a.mode&&(a.width=0,a.height=0),e.push({name:"thumb",value:JSON.stringify(a)})}e.push({name:"type",value:"image"}),console.log("------ sending data ------");for(var d=0;d<e.length;d++){if("file-dialog"==e[d].name&&!e[d].value)return alert("please select an image"),!1;console.log(d,e[d].name,e[d].value)}return!0},uploadProgress:function(e,t,i,o){$(".progress-bar").width(.8*o+"%")},success:function(){$(".progress-bar").width("100%"),console.log("success")},complete:function(e){$(".progress-bar").width("100%"),setTimeout(k,500)}}),v.bind("paste",function(e){setTimeout(function(){y.url=v.val(),-1!=y.url.search("youtube")?(y.id=y.url.substring(y.url.lastIndexOf("?v=")+3),y.url="https://www.youtube.com/embed/"+y.id,l.attr("src",y.url),y.preview="https://img.youtube.com/vi/"+y.id+"/hqdefault.jpg"):-1!=y.url.search("vimeo")&&(y.id=y.url.substring(y.url.lastIndexOf("/")+1),y.url="https://player.vimeo.com/video/"+y.id,l.attr("src",y.url),$.get("https://vimeo.com/api/v2/video/"+y.id+".json",function(e){y.preview=e[0].thumbnail_large}))},1)}),h.ajaxForm({url:o.upload,beforeSubmit:function(e,t,i){return console.log("sending"),e.push({name:"type",value:"video"}),e.push({name:"url",value:y.url}),e.push({name:"preview",value:y.preview}),!0},complete:function(e){setTimeout(k,500)}});var k=function(){r.modal("hide"),r.on("hidden.bs.modal",function(e){location.reload(!0)})},C=function(){d.modal("hide"),d.on("hidden.bs.modal",function(e){location.reload(!0)})};$(".thumb-settings .w").keyup(e),$(".thumb-settings .h").keyup(t),$(".thumb-settings .s1").change(function(e){a.mode=this.value.toLowerCase(),"normal"==a.mode?($(".thumb-settings .w").val(""),$(".thumb-settings .h").val("")):"fixed ratio"==a.mode?($(".thumb-settings .w").val(a.ratio.width),$(".thumb-settings .h").val(a.ratio.height)):"fixed size"==a.mode&&($(".thumb-settings .w").val(a.width),$(".thumb-settings .h").val(a.height)),$(".thumb-settings .w").prop("disabled","normal"==a.mode),$(".thumb-settings .h").prop("disabled","normal"==a.mode)}),$(".thumb-settings .s2").change(function(e){$(".thumb-generator").css("border-color",this.value.toLowerCase())});var z=$(".media-preview img"),L=$(".thumb-generator"),T=$(".media-preview");L.hide(),z.on("dragstart",function(e){e.preventDefault()});var j=parseInt($(".modal-body").css("padding"))+parseInt($(".modal-push .well").css("padding")),I=function(){L.hide(),a.crop={}},P=function(e){var t={x:e.clientX+j,y:e.clientY+j},i={x:T.offset().left-$(window).scrollLeft(),y:T.offset().top-$(window).scrollTop()};return{x:t.x-i.x,y:t.y-i.y}},S=function(e){var t=P(e),i=t.x-a.crop.x,o=t.y-a.crop.y;"fixed ratio"==a.mode&&(o=i*(a.ratio.height/a.ratio.width)),L.css({width:i,height:o})},F=function(e){var t=P(e);a.crop={},a.crop.x=t.x,a.crop.y=t.y,L.css({left:a.crop.x,top:a.crop.y}),"fixed size"!=a.mode?(z.bind("mousemove",S),z.css("cursor","crosshair"),L.css({width:0,height:0})):L.css({width:a.width*(z.width()/x.width),height:a.height*(z.height()/x.height)}),L.show()},M=function(){z.css("cursor","default"),z.unbind("mousemove",S)};$(window).bind("mouseup",M),z.bind("mousedown",F),document.addEventListener("keydown",function(e){L.is(":visible")&&(37==e.keyCode?a.crop.x--:38==e.keyCode?a.crop.y--:39==e.keyCode?a.crop.x++:40==e.keyCode&&a.crop.y++,L.css({left:a.crop.x,top:a.crop.y}))},!1),$(".modal-pop").on("hidden.bs.modal",function(e){var t=$(".modal-pop .media-preview img"),i=$(".modal-pop .media-preview iframe");t.hide(),t.attr("src",""),i.hide(),i.attr("src","")}),$(".modal-pop form").ajaxForm({url:o["delete"],beforeSubmit:function(e,t,i){e.push({name:"pname",value:d.data("pname")}),e.push({name:"index",value:d.data("index")})},complete:function(e){setTimeout(C,500)}})}